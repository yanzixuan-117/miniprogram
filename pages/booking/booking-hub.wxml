<!-- pages/booking/booking-hub.wxml -->
<view class="hub-container">
  <!-- å­¦å‘˜è§†å›¾ -->
  <view class="student-view" wx:if="{{currentView === 'student'}}">
    <!-- çŠ¶æ€ç­›é€‰ -->
    <scroll-view class="status-tabs" scroll-x enhanced show-scrollbar="{{false}}">
      <view class="tab-item {{studentActiveStatus === '' ? 'active' : ''}}" bindtap="selectStudentStatus" data-status="">
        å…¨éƒ¨
      </view>
      <view class="tab-item {{studentActiveStatus === 'pending' ? 'active' : ''}}" bindtap="selectStudentStatus" data-status="pending">
        å¾…å®¡æ ¸
      </view>
      <view class="tab-item {{studentActiveStatus === 'confirmed' ? 'active' : ''}}" bindtap="selectStudentStatus" data-status="confirmed">
        å·²ç¡®è®¤
      </view>
      <view class="tab-item {{studentActiveStatus === 'completed' ? 'active' : ''}}" bindtap="selectStudentStatus" data-status="completed">
        å·²å®Œæˆ
      </view>
      <view class="tab-item {{studentActiveStatus === 'cancelled' ? 'active' : ''}}" bindtap="selectStudentStatus" data-status="cancelled">
        å·²å–æ¶ˆ
      </view>
    </scroll-view>

    <!-- é¢„çº¦åˆ—è¡¨ -->
    <view class="booking-list" wx:if="{{!studentLoading && studentBookings.length > 0}}">
      <view class="booking-item" wx:for="{{studentBookings}}" wx:key="_id">
        <view class="booking-card">
          <!-- æ—¥æœŸæ˜¾ç¤º -->
          <view class="booking-date">
            <view class="date-calendar">
              <text class="date-month">{{item.dateText.month}}æœˆ</text>
              <text class="date-day">{{item.dateText.day}}</text>
              <text class="date-weekday">å‘¨{{item.dateText.weekday}}</text>
            </view>
            <view class="booking-time">
              <text class="time-text">{{item.startTime}}-{{item.endTime}}</text>
            </view>
          </view>

          <!-- æ•™ç»ƒä¿¡æ¯ -->
          <view class="booking-coach">
            <image class="coach-avatar" src="{{item.coachAvatar}}" mode="aspectFill"></image>
            <view class="coach-info">
              <text class="coach-name">{{item.coachName}}</text>
              <view class="status-badge status-{{item.status}}">
                {{item.statusText}}
              </view>
            </view>
          </view>

          <!-- å¤‡æ³¨ä¿¡æ¯ -->
          <view class="booking-note" wx:if="{{item.studentNote}}">
            <text class="note-label">å¤‡æ³¨ï¼š</text>
            <text class="note-text">{{item.studentNote}}</text>
          </view>

          <!-- æ“ä½œæŒ‰é’® -->
          <view class="booking-actions" wx:if="{{item.canCancel}}">
            <button class="action-btn cancel" catchtap="cancelBooking" data-id="{{item._id}}">å–æ¶ˆé¢„çº¦</button>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view class="loading-state" wx:if="{{studentLoading}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!studentLoading && studentBookings.length === 0}}">
      <text class="empty-icon">ğŸ“…</text>
      <text class="empty-text">æš‚æ— é¢„çº¦è®°å½•</text>
      <text class="empty-hint">å¿«å»é¢„çº¦ä¸€èŠ‚ç½‘çƒè¯¾ç¨‹å§</text>
      <button class="go-booking-btn" bindtap="goToBooking">ç«‹å³é¢„çº¦</button>
    </view>
  </view>

  <!-- æ•™ç»ƒè§†å›¾ -->
  <view class="coach-view" wx:if="{{currentView === 'coach'}}">
    <!-- çŠ¶æ€ç­›é€‰ -->
    <scroll-view class="status-tabs" scroll-x enhanced show-scrollbar="{{false}}">
      <view class="tab-item {{coachActiveStatus === '' ? 'active' : ''}}" bindtap="selectCoachStatus" data-status="">
        å…¨éƒ¨
      </view>
      <view class="tab-item {{coachActiveStatus === 'pending' ? 'active' : ''}}" bindtap="selectCoachStatus" data-status="pending">
        å¾…å®¡æ ¸
      </view>
      <view class="tab-item {{coachActiveStatus === 'confirmed' ? 'active' : ''}}" bindtap="selectCoachStatus" data-status="confirmed">
        å·²ç¡®è®¤
      </view>
      <view class="tab-item {{coachActiveStatus === 'completed' ? 'active' : ''}}" bindtap="selectCoachStatus" data-status="completed">
        å·²å®Œæˆ
      </view>
    </scroll-view>

    <!-- é¢„çº¦åˆ—è¡¨ -->
    <view class="booking-list" wx:if="{{!coachLoading && coachBookings.length > 0}}">
      <view class="booking-item" wx:for="{{coachBookings}}" wx:key="_id">
        <view class="booking-card">
          <!-- æ—¥æœŸæ˜¾ç¤º -->
          <view class="booking-date">
            <view class="date-calendar {{item.status === 'pending' ? 'pending' : ''}}">
              <text class="date-month">{{item.dateText.month}}æœˆ</text>
              <text class="date-day">{{item.dateText.day}}</text>
              <text class="date-weekday">å‘¨{{item.dateText.weekday}}</text>
            </view>
            <view class="booking-time">
              <text class="time-text">{{item.startTime}}-{{item.endTime}}</text>
              <view class="status-badge status-{{item.status}}">
                {{item.statusText}}
              </view>
            </view>
          </view>

          <!-- å­¦å‘˜ä¿¡æ¯ -->
          <view class="booking-student">
            <image class="student-avatar" src="{{item.studentAvatar}}" mode="aspectFill"></image>
            <view class="student-info">
              <text class="student-name">{{item.studentName}}</text>
              <text class="booking-date-text">{{item.dateText.full}}</text>
              <!-- ä¸Šè¯¾äººåˆ—è¡¨ -->
              <view class="students-list" wx:if="{{item.students && item.students.length > 0}}">
                <text class="students-label">ä¸Šè¯¾äººï¼š</text>
                <text class="students-names">
                  <text>{{item.studentName}}</text>
                  <text>ã€</text>
                  <block wx:for="{{item.students}}" wx:key="name" wx:for-index="sIdx" wx:for-item="student">
                    <text>{{student.name}}</text>
                    <text wx:if="{{sIdx < item.students.length - 1}}">ã€</text>
                  </block>
                </text>
              </view>
            </view>
          </view>

          <!-- å¤‡æ³¨ä¿¡æ¯ -->
          <view class="booking-note" wx:if="{{item.studentNote}}">
            <text class="note-label">å¤‡æ³¨ï¼š</text>
            <text class="note-text">{{item.studentNote}}</text>
          </view>

          <!-- æ“ä½œæŒ‰é’® -->
          <view class="booking-actions">
            <!-- å¾…å®¡æ ¸çŠ¶æ€ -->
            <block wx:if="{{item.status === 'pending'}}">
              <button class="action-btn reject" catchtap="rejectBooking" data-id="{{item._id}}">æ‹’ç»</button>
              <button class="action-btn confirm" catchtap="confirmBooking" data-id="{{item._id}}">ç¡®è®¤</button>
            </block>

            <!-- å·²ç¡®è®¤çŠ¶æ€ -->
            <block wx:if="{{item.status === 'confirmed'}}">
              <button class="action-btn complete" catchtap="completeBooking" data-id="{{item._id}}">å®Œæˆè¯¾ç¨‹</button>
            </block>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view class="loading-state" wx:if="{{coachLoading}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!coachLoading && coachBookings.length === 0}}">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— é¢„çº¦è®°å½•</text>
      <text class="empty-hint">å½“æœ‰å­¦å‘˜é¢„çº¦æ‚¨çš„è¯¾ç¨‹æ—¶ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
    </view>
  </view>
</view>

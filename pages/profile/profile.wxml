<!--pages/profile/profile.wxml-->
<view class="container">
  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view class="not-login" wx:if="{{!hasLogin}}">
    <view class="login-prompt">
      <view class="login-icon">ğŸ¾</view>
      <text class="login-title">æ¬¢è¿ä½¿ç”¨æŒ¥æ‹GO</text>
      <text class="login-subtitle">è¯·å…ˆç™»å½•ä»¥ä½¿ç”¨å…¨éƒ¨åŠŸèƒ½</text>
      <button class="login-btn" bindtap="goToLogin">ç«‹å³ç™»å½•</button>
    </view>
  </view>

  <!-- å·²ç™»å½•çŠ¶æ€ -->
  <view class="logged-in" wx:if="{{hasLogin}}">
    <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
    <view class="profile-header">
      <view class="avatar-wrapper">
        <image
          class="avatar"
          src="{{userInfo.avatarUrl || '/images/avatar.png'}}"
          mode="aspectFill"
        ></image>
        <view class="avatar-border"></view>
      </view>
      <text class="nickname">{{userInfo.nickname || 'æœªè®¾ç½®æ˜µç§°'}}</text>
      <view class="role-badge role-{{userInfo.role}}">
        <text class="role-icon">{{userInfo.role === 'student' ? 'ğŸ¾' : (userInfo.role === 'coach' ? 'ğŸ‘¨â€ğŸ«' : 'â­')}}</text>
        <text>{{roleText}}</text>
      </view>
    </view>

    <!-- ç®¡ç†å‘˜è§’è‰²åˆ‡æ¢ -->
    <view class="admin-role-switcher" wx:if="{{isAdmin}}">
      <view class="switcher-header">
        <text class="switcher-icon">ğŸ”„</text>
        <text class="switcher-title">è§’è‰²åˆ‡æ¢</text>
      </view>
      <view class="role-options">
        <view
          class="role-option {{currentRole === 'admin' ? 'active' : ''}}"
          bindtap="switchRole"
          data-role="admin">
          <view class="role-icon-wrapper role-admin">
            <text class="role-icon">â­</text>
          </view>
          <view class="role-text">
            <text class="role-name">ç®¡ç†å‘˜</text>
            <text class="role-desc">ç³»ç»Ÿç®¡ç†</text>
          </view>
          <view class="role-check {{currentRole === 'admin' ? 'show' : ''}}">
            <text>âœ“</text>
          </view>
        </view>
        <view
          class="role-option {{currentRole === 'coach' ? 'active' : ''}}"
          bindtap="switchRole"
          data-role="coach">
          <view class="role-icon-wrapper role-coach">
            <text class="role-icon">ğŸ‘¨â€ğŸ«</text>
          </view>
          <view class="role-text">
            <text class="role-name">æ•™ç»ƒ</text>
            <text class="role-desc">è¯¾ç¨‹ç®¡ç†</text>
          </view>
          <view class="role-check {{currentRole === 'coach' ? 'show' : ''}}">
            <text>âœ“</text>
          </view>
        </view>
        <view
          class="role-option {{currentRole === 'student' ? 'active' : ''}}"
          bindtap="switchRole"
          data-role="student">
          <view class="role-icon-wrapper role-student">
            <text class="role-icon">ğŸ¾</text>
          </view>
          <view class="role-text">
            <text class="role-name">å­¦å‘˜</text>
            <text class="role-desc">é¢„çº¦å­¦ä¹ </text>
          </view>
          <view class="role-check {{currentRole === 'student' ? 'show' : ''}}">
            <text>âœ“</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ•™ç»ƒç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-row" wx:if="{{canViewCoach}}">
      <view class="stat-item">
        <text class="stat-number">{{stats.totalStudents}}</text>
        <text class="stat-label">å­¦å‘˜æ•°</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.totalSessions}}</text>
        <text class="stat-label">è¯¾ç¨‹æ•°</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.rating}}</text>
        <text class="stat-label">è¯„åˆ†</text>
      </view>
    </view>

    <!-- å­¦å‘˜ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-row" wx:if="{{canViewStudent}}">
      <view class="stat-item">
        <text class="stat-number">{{stats.totalBookings}}</text>
        <text class="stat-label">æ€»é¢„çº¦</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.completedSessions}}</text>
        <text class="stat-label">å·²å®Œæˆ</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.favoriteVideos}}</text>
        <text class="stat-label">æ”¶è—è§†é¢‘</text>
      </view>
    </view>

    <!-- åŠŸèƒ½èœå• -->
    <view class="menu-section">
      <view class="section-title">æˆ‘çš„æœåŠ¡</view>
      <view class="menu-grid">
        <view class="menu-card" bindtap="goToMyBookings">
          <view class="menu-card-icon">ğŸ“…</view>
          <text class="menu-card-text">æˆ‘çš„é¢„çº¦</text>
        </view>
        <view class="menu-card" bindtap="goToMyRecords">
          <view class="menu-card-icon">ğŸ“</view>
          <text class="menu-card-text">è¯¾ç¨‹è®°å½•</text>
        </view>
        <view class="menu-card" bindtap="goToFavorites">
          <view class="menu-card-icon">â­</view>
          <text class="menu-card-text">æˆ‘çš„æ”¶è—</text>
        </view>
        <view class="menu-card" wx:if="{{canViewCoach}}" bindtap="goToSessionHistory">
          <view class="menu-card-icon">ğŸ“Š</view>
          <text class="menu-card-text">æ•™å­¦å†å²</text>
        </view>
      </view>
    </view>

    <!-- è´¦æˆ·è®¾ç½® -->
    <view class="menu-list">
      <view class="section-title">è´¦æˆ·è®¾ç½®</view>

      <view class="menu-item" bindtap="editProfile">
        <view class="menu-icon">ğŸ‘¤</view>
        <text class="menu-text">ç¼–è¾‘èµ„æ–™</text>
        <text class="arrow">></text>
      </view>

      <view class="menu-item" wx:if="{{canViewCoach}}" bindtap="goToCoachProfile">
        <view class="menu-icon">ğŸ‘¨â€ğŸ«</view>
        <text class="menu-text">æ•™ç»ƒèµ„æ–™</text>
        <text class="arrow">></text>
      </view>

      <view class="menu-item" wx:if="{{canViewCoach}}" bindtap="goToSchedule">
        <view class="menu-icon">â°</view>
        <text class="menu-text">æ—¶é—´è®¾ç½®</text>
        <text class="arrow">></text>
      </view>

      <view class="menu-item" wx:if="{{canViewCoach}}" bindtap="goToVideoManage">
        <view class="menu-icon">ğŸ¬</view>
        <text class="menu-text">è§†é¢‘ç®¡ç†</text>
        <text class="arrow">></text>
      </view>

      <view class="menu-item" wx:if="{{canViewAdmin}}" bindtap="goToAdminManage">
        <view class="menu-icon">âš¡</view>
        <text class="menu-text">ç®¡ç†å‘˜åŠŸèƒ½</text>
        <text class="arrow">></text>
      </view>

      <view class="menu-item" bindtap="goToSettings">
        <view class="menu-icon">âš™ï¸</view>
        <text class="menu-text">è®¾ç½®</text>
        <text class="arrow">></text>
      </view>

      <view class="menu-item" bindtap="goToAbout">
        <view class="menu-icon">â„¹ï¸</view>
        <text class="menu-text">å…³äºæˆ‘ä»¬</text>
        <text class="arrow">></text>
      </view>

      <view class="menu-item account-delete" bindtap="goToAccountDelete">
        <view class="menu-icon delete-icon">ğŸ—‘ï¸</view>
        <text class="menu-text delete-text">è´¦å·æ³¨é”€</text>
        <text class="arrow">></text>
      </view>
    </view>

    <!-- é€€å‡ºç™»å½• -->
    <button class="logout-btn" bindtap="handleLogout">
      <text>é€€å‡ºç™»å½•</text>
    </button>

    <!-- ç”¨æˆ·ä¿¡æ¯ -->
    <view class="user-info-footer">
      <text class="info-text">æ³¨å†Œæ—¶é—´: {{createTimeText}}</text>
    </view>
  </view>
</view>

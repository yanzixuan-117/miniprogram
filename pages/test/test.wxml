<!--pages/test/test.wxml-->
<view class="container">
  <view class="test-header">
    <text class="title">云开发调试面板</text>
    <text class="subtitle">用于测试云函数和数据库连接</text>
  </view>

  <!-- 环境信息 -->
  <view class="section">
    <view class="section-title">环境信息</view>
    <view class="info-row">
      <text class="label">环境ID:</text>
      <text class="value">{{envId || '未配置'}}</text>
    </view>
    <view class="info-row">
      <text class="label">用户状态:</text>
      <text class="value {{hasOpenid ? 'success' : ''}}">{{hasOpenid ? '已获取' : '未登录'}}</text>
    </view>
    <view class="info-row" wx:if="{{openid}}">
      <text class="label">OpenID:</text>
      <text class="value small">{{openid}}</text>
    </view>
  </view>

  <!-- 快捷操作 -->
  <view class="section">
    <view class="section-title">快捷操作</view>

    <button class="test-btn primary" bindtap="goToHome">
      🏠 返回首页（测试登录）
    </button>

    <button class="test-btn primary" bindtap="goToLogin">
      🔑 直接登录
    </button>

    <button class="test-btn warning" bindtap="checkUserInfo">
      🔍 检查用户信息（调试）
    </button>

    <button class="test-btn danger" bindtap="fixToAdmin">
      🔧 一键修复：设置为管理员
    </button>
  </view>

  <!-- 测试按钮 -->
  <view class="section">
    <view class="section-title">功能测试</view>

    <button class="test-btn" bindtap="testCloudFunction" disabled="{{testing}}">
      {{testing ? '测试中...' : '测试云函数连接'}}
    </button>

    <button class="test-btn" bindtap="testDatabase" disabled="{{testing}}">
      {{testing ? '测试中...' : '测试数据库查询'}}
    </button>

    <button class="test-btn" bindtap="testGetOpenId" disabled="{{testing}}">
      {{testing ? '测试中...' : '获取用户 OpenID'}}
    </button>

    <button class="test-btn secondary" bindtap="testCreateCollection" disabled="{{testing}}">
      {{testing ? '创建中...' : '创建测试数据'}}
    </button>

    <button class="test-btn secondary" bindtap="clearLogs">
      清空日志
    </button>
  </view>

  <!-- 测试结果 -->
  <view class="section" wx:if="{{logs.length > 0}}">
    <view class="section-title">测试日志</view>
    <scroll-view class="log-container" scroll-y scroll-into-view="log-bottom">
      <view class="log-item {{item.type}}" wx:for="{{logs}}" wx:key="index" id="log-{{index}}">
        <text class="log-time">{{item.time}}</text>
        <text class="log-message">{{item.message}}</text>
        <text class="log-data" wx:if="{{item.data}}">{{item.data}}</text>
      </view>
    </scroll-view>
  </view>
</view>

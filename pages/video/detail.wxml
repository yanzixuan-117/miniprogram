<!--pages/video/detail.wxml-->
<view class="detail-container" wx:if="{{!loading && video}}">
  <!-- è§†é¢‘æ’­æ”¾å™¨ -->
  <view class="video-player-wrapper">
    <video
      id="videoPlayer"
      class="video-player"
      src="{{video.videoUrl}}"
      poster="{{video.thumbnail}}"
      controls
      show-center-play-btn
      autoplay
      loop
      muted="{{false}}"
      bindplay="onPlay"
      bindpause="onPause"
      bindended="onEnded"
      object-fit="contain"
    >
      <cover-view class="video-cover" wx:if="{{!playing}}" bindtap="onTapCover">
        <cover-image class="cover-image" src="{{video.thumbnail}}" mode="aspectFill"></cover-image>
        <cover-view class="play-btn">â–¶</cover-view>
      </cover-view>
    </video>
  </view>

  <!-- è§†é¢‘ä¿¡æ¯ -->
  <view class="video-info">
    <!-- æ ‡é¢˜å’Œç»Ÿè®¡ -->
    <view class="info-header">
      <text class="video-title">{{video.title}}</text>
      <view class="video-stats">
        <text class="stat-item">ğŸ‘ {{video.viewCount || 0}}</text>
        <text class="stat-item">ğŸ‘ {{video.likeCount || 0}}</text>
      </view>
    </view>

    <!-- åˆ†ç±»å’Œéš¾åº¦ -->
    <view class="video-meta">
      <view class="meta-tag category-tag">{{video.category}}</view>
      <view class="meta-tag difficulty-tag difficulty-{{video.difficulty}}">
        {{video.difficultyText}}
      </view>
      <text class="video-duration">â± {{video.durationText || '00:00'}}</text>
    </view>

    <!-- æ ‡ç­¾ -->
    <view class="tags-row" wx:if="{{video.tags && video.tags.length > 0}}">
      <text class="tag-item" wx:for="{{video.tags}}" wx:key="*this">#{{item}}</text>
    </view>

    <!-- ç®€ä»‹ -->
    <view class="video-description" wx:if="{{video.description}}">
      <text class="description-label">ç®€ä»‹ï¼š</text>
      <text class="description-text">{{video.description}}</text>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-bar">
      <view class="action-btn" catchtap="onLike">
        <text class="action-icon">{{isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
        <text class="action-text">{{isLiked ? 'å·²èµ' : 'ç‚¹èµ'}}</text>
      </view>
      <view class="action-btn" catchtap="onFavorite">
        <text class="action-icon">{{isFavorited ? 'â­' : 'â˜†'}}</text>
        <text class="action-text">{{isFavorited ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
      </view>
      <view class="action-btn" catchtap="onShare">
        <text class="action-icon">ğŸ“¤</text>
        <text class="action-text">åˆ†äº«</text>
      </view>
      <view class="action-btn" catchtap="onViewComments">
        <text class="action-icon">ğŸ’¬</text>
        <text class="action-text">è¯„è®º</text>
      </view>
    </view>
  </view>

  <!-- ä½œè€…ä¿¡æ¯ -->
  <view class="author-section">
    <view class="author-info">
      <image lazy-load class="author-avatar" src="{{video.authorAvatar || '/images/avatar.png'}}" mode="aspectFill"></image>
      <view class="author-detail">
        <text class="author-name">{{video.authorName}}</text>
        <text class="author-role">æ•™ç»ƒ</text>
      </view>
    </view>
    <view class="author-actions">
      <button class="follow-btn" catchtap="onFollowAuthor">+ å…³æ³¨</button>
      <button class="contact-btn" catchtap="onContactCoach">è”ç³»</button>
    </view>
  </view>

  <!-- è¯„è®ºåŒº -->
  <view class="comments-section" wx:if="{{showComments}}">
    <view class="section-header">
      <text class="section-title">è¯„è®º ({{comments.length}})</text>
      <text class="close-btn" catchtap="onCloseComments">å…³é—­</text>
    </view>

    <!-- è¯„è®ºåˆ—è¡¨ -->
    <view class="comments-list" wx:if="{{comments.length > 0}}">
      <view class="comment-item" wx:for="{{comments}}" wx:key="_id">
        <image lazy-load class="comment-avatar" src="{{item.userAvatar}}" mode="aspectFill"></image>
        <view class="comment-content">
          <view class="comment-header">
            <text class="comment-user">{{item.userName}}</text>
            <text class="comment-time">{{item.createTimeText}}</text>
          </view>
          <text class="comment-text">{{item.content}}</text>
          <view class="comment-actions">
            <text class="comment-delete" catchtap="onDeleteComment" data-id="{{item._id}}">åˆ é™¤</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="comments-empty" wx:if="{{comments.length === 0 && !loadingComments}}">
      <text class="empty-text">æš‚æ— è¯„è®º</text>
      <text class="empty-hint">å¿«æ¥å‘è¡¨ç¬¬ä¸€æ¡è¯„è®ºå§</text>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view class="comments-loading" wx:if="{{loadingComments}}">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- å‘è¡¨è¯„è®º -->
    <view class="comment-input-box">
      <input
        class="comment-input"
        type="text"
        placeholder="å‘è¡¨è¯„è®º..."
        value="{{commentContent}}"
        bindinput="onCommentInput"
      />
      <button class="comment-send-btn" catchtap="onPostComment">å‘é€</button>
    </view>
  </view>
</view>

<!-- åŠ è½½ä¸­ -->
<view class="loading-container" wx:if="{{loading}}">
  <text class="loading-text">åŠ è½½ä¸­...</text>
</view>

<!-- pages/session/detail.wxml -->
<view class="session-detail-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- è¯¾ç¨‹è¯¦æƒ… -->
  <view class="session-content" wx:if="{{!loading && session}}">
    <!-- çŠ¶æ€å¡ç‰‡ -->
    <view class="status-card status-{{session.status}}">
      <view class="status-icon">
        <text wx:if="{{session.status === 'pending'}}">â³</text>
        <text wx:if="{{session.status === 'confirmed'}}">âœ…</text>
        <text wx:if="{{session.status === 'completed'}}">ğŸ¾</text>
        <text wx:if="{{session.status === 'cancelled'}}">âŒ</text>
      </view>
      <view class="status-info">
        <text class="status-text">{{session.statusText}}</text>
        <text class="status-desc" wx:if="{{session.status === 'pending'}}">ç­‰å¾…æ•™ç»ƒç¡®è®¤é¢„çº¦</text>
        <text class="status-desc" wx:if="{{session.status === 'confirmed'}}">æ•™ç»ƒå·²ç¡®è®¤ï¼Œè¯·æŒ‰æ—¶å‚åŠ </text>
        <text class="status-desc" wx:if="{{session.status === 'completed'}}">è¯¾ç¨‹å·²å®Œæˆ</text>
        <text class="status-desc" wx:if="{{session.status === 'cancelled'}}">é¢„çº¦å·²å–æ¶ˆ</text>
      </view>
    </view>

    <!-- æ—¥æœŸå’Œæ—¶é—´å¡ç‰‡ -->
    <view class="info-card">
      <view class="card-title">
        <text class="title-icon">ğŸ“…</text>
        <text class="title-text">è¯¾ç¨‹æ—¶é—´</text>
      </view>
      <view class="datetime-display">
        <view class="date-calendar">
          <text class="date-month">{{session.dateText.month}}æœˆ</text>
          <text class="date-day">{{session.dateText.day}}</text>
          <text class="date-weekday">å‘¨{{session.dateText.weekday}}</text>
        </view>
        <view class="time-info">
          <text class="time-text">{{session.startTime}}-{{session.endTime}}</text>
          <text class="time-duration">1å°æ—¶</text>
        </view>
      </view>
    </view>

    <!-- æ•™ç»ƒä¿¡æ¯å¡ç‰‡ -->
    <view class="info-card">
      <view class="card-title">
        <text class="title-icon">ğŸ‘¨â€ğŸ«</text>
        <text class="title-text">æ•™ç»ƒä¿¡æ¯</text>
      </view>
      <view class="coach-detail">
        <image class="coach-avatar" src="{{session.coachAvatar }}" mode="aspectFill"></image>
        <view class="coach-info">
          <text class="coach-name">{{session.coachName}}</text>
          <view class="coach-tags" wx:if="{{session.coachSpecialty && session.coachSpecialty.length > 0}}">
            <text class="tag" wx:for="{{session.coachSpecialty}}" wx:key="*this">{{item}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å­¦å‘˜ä¿¡æ¯å¡ç‰‡ï¼ˆæ•™ç»ƒç«¯æ˜¾ç¤ºï¼‰ -->
    <view class="info-card" wx:if="{{userRole === 'coach' || userRole === 'admin'}}">
      <view class="card-title">
        <text class="title-icon">ğŸ‘¤</text>
        <text class="title-text">å­¦å‘˜ä¿¡æ¯</text>
      </view>
      <view class="coach-detail">
        <image class="coach-avatar" src="{{session.studentAvatar }}" mode="aspectFill"></image>
        <view class="coach-info">
          <text class="coach-name">{{session.studentName}}</text>
          <!-- ä¸Šè¯¾äººåˆ—è¡¨ -->
          <view class="coach-tags" wx:if="{{session.students && session.students.length > 0}}">
            <text class="tag" wx:for="{{session.students}}" wx:key="*this">+{{item.name}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- çƒé¦†ä¿¡æ¯å¡ç‰‡ -->
    <view class="info-card" wx:if="{{session.venue}}">
      <view class="card-title">
        <text class="title-icon">ğŸŸï¸</text>
        <text class="title-text">çƒé¦†ä¿¡æ¯</text>
      </view>
      <view class="venue-detail">
        <text class="venue-name">{{session.venue}}</text>
        <text class="venue-address" wx:if="{{session.venueAddress}}">{{session.venueAddress}}</text>
      </view>
    </view>

    <!-- å­¦å‘˜å¤‡æ³¨ -->
    <view class="info-card" wx:if="{{session.studentNote}}">
      <view class="card-title">
        <text class="title-icon">ğŸ“</text>
        <text class="title-text">å­¦å‘˜å¤‡æ³¨</text>
      </view>
      <view class="note-content">
        <text class="note-text">{{session.studentNote}}</text>
      </view>
    </view>

    <!-- æ•™ç»ƒåé¦ˆ -->
    <view class="info-card" wx:if="{{session.feedback || session.status === 'completed'}}">
      <view class="card-title">
        <text class="title-icon">ğŸ’¬</text>
        <text class="title-text">æ•™ç»ƒåé¦ˆ</text>
      </view>
      <view class="note-content coach-note">
        <text class="note-text" wx:if="{{session.feedback}}">{{session.feedback}}</text>
        <text class="empty-note" wx:else>{{session.status === 'completed' ? 'æ•™ç»ƒæš‚æœªæ·»åŠ åé¦ˆ' : 'è¯¾ç¨‹ç»“æŸåæ•™ç»ƒä¼šæ·»åŠ åé¦ˆ'}}</text>
      </view>
    </view>

    <!-- è¯¾ç¨‹ç…§ç‰‡ -->
    <view class="info-card" wx:if="{{session.photos && session.photos.length > 0}}">
      <view class="card-title">
        <text class="title-icon">ğŸ“·</text>
        <text class="title-text">è¯¾ç¨‹ç…§ç‰‡</text>
      </view>
      <view class="photos-grid">
        <view class="photo-item" wx:for="{{session.photos}}" wx:key="*this">
          <image class="photo-image" src="{{item}}" mode="aspectFill" bindtap="previewImage" data-url="{{item}}" data-urls="{{session.photos}}"></image>
        </view>
      </view>
    </view>

    <!-- åˆ›å»ºæ—¶é—´ -->
    <view class="info-meta" wx:if="{{session.createTime}}">
      <text class="meta-text">é¢„çº¦æ—¶é—´ï¼š{{session.createTimeText}}</text>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
  <view class="action-section" wx:if="{{!loading && session && isOwner}}">
    <!-- å­¦å‘˜è§†è§’ï¼šå¾…å®¡æ ¸/å·²ç¡®è®¤çŠ¶æ€æ˜¾ç¤ºå–æ¶ˆæŒ‰é’® -->
    <view class="actions" wx:if="{{userRole === 'student' && (session.status === 'pending' || session.status === 'confirmed')}}">
      <button class="action-btn cancel" catchtap="cancelSession">å–æ¶ˆé¢„çº¦</button>
    </view>

    <!-- æ•™ç»ƒè§†è§’ï¼šå¾…å®¡æ ¸çŠ¶æ€æ˜¾ç¤ºåŒæ„/æ‹’ç»æŒ‰é’® -->
    <view class="actions" wx:if="{{(userRole === 'coach' || userRole === 'admin') && session.status === 'pending'}}">
      <button class="action-btn reject" catchtap="rejectBooking">æ‹’ç»é¢„çº¦</button>
      <button class="action-btn confirm" catchtap="confirmBooking">åŒæ„é¢„çº¦</button>
    </view>

    <!-- æ•™ç»ƒè§†è§’ï¼šå·²ç¡®è®¤çŠ¶æ€æ˜¾ç¤ºå®ŒæˆæŒ‰é’® -->
    <view class="actions" wx:if="{{(userRole === 'coach' || userRole === 'admin') && session.status === 'confirmed'}}">
      <button class="action-btn complete" catchtap="completeBooking">å®Œæˆè¯¾ç¨‹</button>
    </view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-state" wx:if="{{!loading && error}}">
    <text class="error-icon">âš ï¸</text>
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" catchtap="goBack">è¿”å›</button>
  </view>
</view>

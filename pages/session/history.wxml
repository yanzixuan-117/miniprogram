<!--pages/session/history-->
<view class="container">
  <!-- é¡¶éƒ¨ç»Ÿè®¡æ  -->
  <view class="stats-header">
    <view class="stat-item">
      <text class="stat-value">{{totalSessions || 0}}</text>
      <text class="stat-label">æ€»è¯¾ç¨‹æ•°</text>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-value">{{totalStudents || 0}}</text>
      <text class="stat-label">å­¦å‘˜æ•°</text>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-value">{{totalHours || 0}}</text>
      <text class="stat-label">æ€»æ—¶é•¿(h)</text>
    </view>
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <view class="filter-tabs">
      <view
        class="filter-tab {{filterType === 'all' ? 'active' : ''}}"
        bindtap="onFilterChange"
        data-type="all"
      >
        å…¨éƒ¨
      </view>
      <view
        class="filter-tab {{filterType === 'week' ? 'active' : ''}}"
        bindtap="onFilterChange"
        data-type="week"
      >
        æœ¬å‘¨
      </view>
      <view
        class="filter-tab {{filterType === 'month' ? 'active' : ''}}"
        bindtap="onFilterChange"
        data-type="month"
      >
        æœ¬æœˆ
      </view>
    </view>
    <view class="search-box" bindtap="showSearch">
      <text class="search-icon">ğŸ”</text>
    </view>
  </view>

  <!-- è¯¾ç¨‹è®°å½•åˆ—è¡¨ -->
  <view class="session-list" wx:if="{{sessionList.length > 0}}">
    <view
      class="session-item"
      wx:for="{{sessionList}}"
      wx:key="_id"
      bindtap="viewDetail"
      data-id="{{item._id}}"
    >
      <!-- æ—¥æœŸå¡ç‰‡ -->
      <view class="date-card">
        <text class="date-day">{{item.dateText.day}}</text>
        <text class="date-month">{{item.dateText.month}}æœˆ</text>
        <text class="date-weekday">{{item.dateText.weekday}}</text>
      </view>

      <!-- è¯¾ç¨‹ä¿¡æ¯ -->
      <view class="session-info">
        <view class="session-header">
          <view class="student-name">
            <text class="name">{{item.studentName || 'å­¦å‘˜'}}</text>
          </view>
          <view class="session-duration">
            <text class="duration">{{item.duration || 1}}å°æ—¶</text>
          </view>
        </view>

        <!-- è¯¾ç¨‹å†…å®¹æ‘˜è¦ -->
        <view class="session-content" wx:if="{{item.content}}">
          <text class="content-text">{{item.content}}</text>
        </view>

        <!-- è®­ç»ƒé‡ç‚¹æ ‡ç­¾ -->
        <view class="session-tags" wx:if="{{item.focusPoints && item.focusPoints.length > 0}}">
          <view class="tag" wx:for="{{item.focusPoints}}" wx:key="index" wx:for-item="point">
            <text>{{point}}</text>
          </view>
        </view>

        <!-- åº•éƒ¨ä¿¡æ¯ -->
        <view class="session-footer">
          <view class="time-info">
            <text class="time">{{item.startTime}}</text>
            <text class="divider">-</text>
            <text class="time">{{item.endTime}}</text>
          </view>
          <view class="view-detail">
            <text>æŸ¥çœ‹è¯¦æƒ…</text>
            <text class="arrow">â€º</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{sessionList.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ“</text>
    <text class="empty-text">æš‚æ— è¯¾ç¨‹è®°å½•</text>
    <text class="empty-hint">å¼€å§‹è®°å½•æ‚¨çš„ç¬¬ä¸€å ‚è¯¾ç¨‹å§</text>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore && !loading}}">
    <text class="load-more-text" bindtap="loadMore">åŠ è½½æ›´å¤š</text>
  </view>

  <!-- æ²¡æœ‰æ›´å¤š -->
  <view class="no-more" wx:if="{{!hasMore && sessionList.length > 0}}">
    <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
  </view>
</view>

<!-- pages/session/create.wxml -->
<view class="create-session-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- è¯¾ç¨‹å†…å®¹ -->
  <view class="session-content" wx:if="{{!loading && booking}}">
    <!-- è¯¾ç¨‹ä¿¡æ¯å¡ç‰‡ -->
    <view class="info-card">
      <view class="card-title">
        <text class="title-icon">ğŸ“‹</text>
        <text class="title-text">è¯¾ç¨‹ä¿¡æ¯</text>
      </view>

      <view class="info-row">
        <text class="info-label">å­¦å‘˜å§“å</text>
        <text class="info-value">{{booking.studentName}}</text>
      </view>

      <view class="info-row" wx:if="{{booking.students && booking.students.length > 0}}">
        <text class="info-label">ä¸Šè¯¾äºº</text>
        <text class="info-value">
          <text>{{booking.studentName}}</text>
          <text wx:if="{{booking.students.length > 0}}">ã€</text>
          <block wx:for="{{booking.students}}" wx:key="name" wx:for-index="sIdx" wx:for-item="student">
            <text>{{student.name}}</text>
            <text wx:if="{{sIdx < booking.students.length - 1}}">ã€</text>
          </block>
        </text>
      </view>

      <view class="info-row">
        <text class="info-label">è¯¾ç¨‹æ—¶é—´</text>
        <text class="info-value">{{booking.dateText}} {{booking.startTime}}-{{booking.endTime}}</text>
      </view>

      <view class="info-row" wx:if="{{booking.venue}}">
        <text class="info-label">çƒé¦†</text>
        <text class="info-value">{{booking.venue}}</text>
      </view>

      <view class="info-row" wx:if="{{booking.studentNote}}">
        <text class="info-label">å­¦å‘˜å¤‡æ³¨</text>
        <text class="info-value note">{{booking.studentNote}}</text>
      </view>
    </view>

    <!-- è¯¾ç¨‹åé¦ˆ -->
    <view class="feedback-card">
      <view class="card-title">
        <text class="title-icon">ğŸ’¬</text>
        <text class="title-text">è¯¾ç¨‹åé¦ˆ</text>
        <text class="title-required">*</text>
      </view>

      <textarea
        class="feedback-input"
        placeholder="è¯·å¡«å†™æœ¬æ¬¡è¯¾ç¨‹çš„åé¦ˆå†…å®¹ï¼Œå¦‚ï¼šå­¦å‘˜è¡¨ç°ã€ç»ƒä¹ é‡ç‚¹ã€å»ºè®®ç­‰"
        value="{{feedback}}"
        bindinput="onFeedbackInput"
        maxlength="500"
        show-confirm-bar="{{false}}"
        auto-height
      ></textarea>
      <view class="feedback-count">{{feedback.length}}/500</view>
    </view>

    <!-- è¯¾ç¨‹çŠ¶æ€ -->
    <view class="status-card">
      <view class="card-title">
        <text class="title-icon">ğŸ“Œ</text>
        <text class="title-text">è¯¾ç¨‹çŠ¶æ€</text>
      </view>

      <view class="status-options">
        <view
          class="status-option {{status === 'completed' ? 'active' : ''}}"
          bindtap="selectStatus"
          data-status="completed"
        >
          <view class="status-icon">âœ…</view>
          <text class="status-text">å·²å®Œæˆ</text>
          <view class="status-check" wx:if="{{status === 'completed'}}">âœ“</view>
        </view>

        <view
          class="status-option {{status === 'cancelled' ? 'active' : ''}}"
          bindtap="selectStatus"
          data-status="cancelled"
        >
          <view class="status-icon">âŒ</view>
          <text class="status-text">å·²å–æ¶ˆ</text>
          <view class="status-check" wx:if="{{status === 'cancelled'}}">âœ“</view>
        </view>
      </view>

      <view class="status-tip" wx:if="{{status === 'cancelled'}}">
        <text class="tip-icon">âš ï¸</text>
        <text class="tip-text">å–æ¶ˆåä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œ</text>
      </view>
    </view>

    <!-- è¯¾ç¨‹ç…§ç‰‡ï¼ˆå¯é€‰ï¼‰ -->
    <view class="photos-card">
      <view class="card-title">
        <text class="title-icon">ğŸ“·</text>
        <text class="title-text">è¯¾ç¨‹ç…§ç‰‡ï¼ˆå¯é€‰ï¼‰</text>
      </view>

      <view class="photos-grid">
        <view class="photo-item" wx:for="{{photos}}" wx:key="index">
          <image class="photo-image" src="{{item}}" mode="aspectFill"></image>
          <view class="photo-delete" catchtap="deletePhoto" data-index="{{index}}">
            <text class="delete-icon">Ã—</text>
          </view>
        </view>

        <view class="photo-add" wx:if="{{photos.length < 9}}" bindtap="choosePhoto">
          <text class="add-icon">+</text>
          <text class="add-text">æ·»åŠ ç…§ç‰‡</text>
        </view>
      </view>

      <view class="photos-tip">
        <text class="tip-text">æœ€å¤šå¯ä¸Šä¼ 9å¼ ç…§ç‰‡</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æŒ‰é’® -->
  <view class="bottom-actions" wx:if="{{!loading}}">
    <button
      class="submit-btn {{submitting ? 'disabled' : ''}}"
      bindtap="submitRecord"
      disabled="{{submitting}}"
    >
      {{submitting ? 'æäº¤ä¸­...' : 'æäº¤è®°å½•'}}
    </button>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-state" wx:if="{{!loading && error}}">
    <text class="error-icon">âš ï¸</text>
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" catchtap="goBack">è¿”å›</button>
  </view>
</view>

<!--pages/admin/student-manage/student-manage.wxml-->
<view class="manage-container">
  <!-- é¡¶éƒ¨ç­›é€‰æ  -->
  <view class="filter-bar">
    <picker class="role-picker" mode="selector" range="{{['å…¨éƒ¨', 'æ¸¸å®¢', 'å­¦å‘˜']}}" range-key="" value="{{roleFilter === 'all' ? 0 : (roleFilter === 'guest' ? 1 : 2)}}" bindchange="onRoleFilterChange">
      <view class="picker-display">
        <text class="picker-text">{{roleFilter === 'all' ? 'å…¨éƒ¨ç”¨æˆ·' : (roleFilter === 'guest' ? 'ä»…æ˜¾ç¤ºæ¸¸å®¢' : 'ä»…æ˜¾ç¤ºå­¦å‘˜')}}</text>
        <text class="picker-arrow">â–¼</text>
      </view>
    </picker>

    <input class="search-input" placeholder="æœç´¢ç”¨æˆ·æ˜µç§°" value="{{keyword}}" bindinput="onSearchInput" />
    <button class="search-btn" bindtap="onSearch">æœç´¢</button>
  </view>

  <!-- ç”¨æˆ·åˆ—è¡¨ -->
  <view class="user-list" wx:if="{{!loading && userList.length > 0}}">
    <view class="user-item" wx:for="{{userList}}" wx:key="_openid">
      <image
        wx:if="{{item.avatarUrl && item.avatarUrl.indexOf('cloud://') !== 0}}"
        class="user-avatar"
        src="{{item.avatarUrl }}"
        mode="aspectFill">
      </image>
      <view class="user-info">
        <text class="user-name">{{item.nickname || 'æœªè®¾ç½®æ˜µç§°'}}</text>
        <view class="user-meta">
          <view class="meta-item role-{{item.role}}">
            {{item.role === 'guest' ? 'æ¸¸å®¢' : (item.role === 'student' ? 'å­¦å‘˜' : (item.role === 'coach' ? 'æ•™ç»ƒ' : 'ç®¡ç†å‘˜'))}}
          </view>
          <text class="meta-item" wx:if="{{item.createTimeText}}">{{item.createTimeText}}</text>
        </view>
      </view>
      <view class="user-actions">
        <button
          class="action-btn add-btn"
          wx:if="{{item.role === 'guest'}}"
          bindtap="addAsStudent"
          data-openid="{{item._openid}}"
          data-name="{{item.nickname}}"
          data-role="{{item.role}}">
          æ·»åŠ ä¸ºå­¦å‘˜
        </button>
        <button
          class="action-btn course-btn"
          wx:if="{{item.role === 'student'}}"
          bindtap="viewStudentCourses"
          data-openid="{{item._openid}}"
          data-name="{{item.nickname}}">
          æŸ¥çœ‹è¯¾ç¨‹
        </button>
        <button
          class="action-btn add-course-btn"
          wx:if="{{item.role === 'student'}}"
          bindtap="addCourse"
          data-openid="{{item._openid}}"
          data-name="{{item.nickname}}">
          æ·»åŠ è¯¾ç¨‹
        </button>
      </view>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-container" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-container" wx:if="{{!loading && userList.length === 0}}">
    <text class="empty-icon">ğŸ‘¥</text>
    <text class="empty-text">æš‚æ— ç”¨æˆ·</text>
  </view>
</view>
